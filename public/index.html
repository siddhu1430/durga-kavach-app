<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Durga Kavach - Safety Companion</title>
Â  Â  <link rel="manifest" href="manifest.json">

    Â  Â  Â  Â  <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
Â  Â  Â  Â  <link rel="apple-touch-icon" href="icon-192x192.png">
Â  Â  Â  Â  <meta name="theme-color" content="#B93C23">
    Â  Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
Â  Â  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
Â  Â  <style>
Â  Â  Â  Â  :root { --accent-color: #ff4500; }
Â  Â  Â  Â  body { margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; background: linear-gradient(-45deg, #ff8c00, #ffd700, #ffffff, #ff8c00); background-size: 400% 400%; animation: gradientShift 15s ease infinite; display: flex; align-items: center; justify-content: center; }
Â  Â  Â  Â  @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
Â  Â  Â  Â  .page { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%; padding: 20px; box-sizing: border-box; }
Â  Â  Â  Â  .page.active { display: flex; }
Â  Â  Â  Â  .form-container { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 15px; box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); text-align: center; width: 100%; max-width: 400px; }
Â  Â  Â  Â  .form-container h2 { margin-top: 0; } .form-container p { margin: 0 0 20px 0; }
Â  Â  Â  Â  .form-group { text-align: left; margin-bottom: 10px; }
Â  Â  Â  Â  .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
Â  Â  Â  Â  .form-container input, .form-container select, .form-container button { width: 100%; padding: 12px; margin: 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; }
Â  Â  Â  Â  .form-container button { background-color: var(--accent-color); color: white; font-weight: bold; cursor: pointer; border: none; margin-top: 15px; }
Â  Â  Â  Â  #dashboard-page { justify-content: space-between; max-width: 500px; margin: auto; height: 100%; }
Â  Â  Â  Â  .header { text-align: center; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); padding-top: 10px; }
Â  Â  Â  Â  .sos-container { position: relative; display: flex; align-items: center; justify-content: center; padding: 10px 0; }
Â  Â  Â  Â  #sos-btn { width: 120px; height: 120px; border-radius: 50%; background-color: red; color: white; font-size: 28px; font-weight: bold; border: 5px solid white; box-shadow: 0 0 20px rgba(255, 0, 0, 0.8); cursor: pointer; animation: pulse 2s infinite; }
Â  Â  Â  Â  #sos-btn.active { animation: none; background-color: #28a745; } #sos-btn.recording { background-color: #E67E22; animation: pulse-recording 1.5s infinite; }
Â  Â  Â  Â  @keyframes pulse { 0% { transform: scale(0.95); } 70% { transform: scale(1); } 100% { transform: scale(0.95); } }
Â  Â  Â  Â  @keyframes pulse-recording { 0% { box-shadow: 0 0 0 0 rgba(230, 126, 34, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(230, 126, 34, 0); } 100% { box-shadow: 0 0 0 0 rgba(230, 126, 34, 0); } }
Â  Â  Â  Â  .actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; width: 100%; max-width: 400px; }
Â  Â  Â  Â  .actions-grid button { padding: 12px; border-radius: 10px; border: none; background: rgba(255, 255, 255, 0.85); cursor: pointer; font-size: 14px; font-weight: 600; }
Â  Â  Â  Â  #share-location-btn.active { background-color: #28a745; color: white; }
Â  Â  Â  Â  #confirm-safety-btn { background-color: #17a2b8; color: white; margin-left: 10px; font-weight: bold; }
Â  Â  Â  Â  .chat-screen { width: 100%; background: #fff; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; flex-direction: column; flex-grow: 1; margin: 15px 0; overflow: hidden; }
Â  Â  Â  Â  .chat-messages { padding: 15px; overflow-y: auto; flex-grow: 1; display: flex; flex-direction: column; gap: 10px; }
Â  Â  Â  Â  .message { padding: 10px 15px; border-radius: 18px; max-width: 80%; line-height: 1.4; word-wrap: break-word; }
Â  Â  Â  Â  .bot-message { background-color: #f1f0f0; align-self: flex-start; }
Â  Â  Â  Â  .user-message { background-color: var(--accent-color); color: white; align-self: flex-end; }
Â  Â  Â  Â  .chat-input-area { display: flex; padding: 10px; border-top: 1px solid #ddd; align-items: center; }
Â  Â  Â  Â  #chat-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 20px; padding: 10px 15px; font-size: 16px; }
Â  Â  Â  Â  #send-btn { background: var(--accent-color); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; margin-left: 10px; font-size: 18px; cursor: pointer; flex-shrink: 0; }
Â  Â  Â  Â  #chat-call-btn { background: #28a745; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; margin-right: 10px; font-size: 18px; cursor: pointer; flex-shrink: 0; }
Â  Â  Â  Â  .modal { position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; padding: 10px; }
Â  Â  Â  Â  .modal-content { background-color: #fefefe; margin: auto; padding: 25px; border: 1px solid #888; width: 90%; max-width: 500px; border-radius: 15px; }
Â  Â  Â  Â  .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
Â  Â  Â  Â  #contacts-list, #logs-list, #zones-list { padding: 0; list-style: none; max-height: 200px; overflow-y: auto; }
Â  Â  Â  Â  #contacts-list li, #zones-list li { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #eee; }
Â  Â  Â  Â  #contacts-list li span, #zones-list li span { font-weight: bold; }
Â  Â  Â  Â  .delete-btn { background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; padding: 5px 10px;}
Â  Â  Â  Â  #map-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; display: none; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
Â  Â  Â  Â  #map { height: 90%; width: 90%; border-radius: 15px; }
Â  Â  Â  Â  #camera-container { position: fixed; top: 10px; left: 10px; width: 100px; height: 100px; border: 2px solid white; border-radius: 8px; overflow: hidden; z-index: 2000; display: none; }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="login-page" class="page active">
Â  Â  Â  Â  <div class="form-container">
Â  Â  Â  Â  Â  Â  <h2 data-key="loginTitle">Durga Kavach</h2>
Â  Â  Â  Â  Â  Â  <p data-key="loginSubtitle">Please enter your details to begin.</p>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="language-selector" data-key="languageLabel">Language</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="language-selector"><option value="en">English</option><option value="mr">à¤®à¤°à¤¾à¤ à¥€</option></select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="username" data-key="usernameLabel">Your Name</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="username" data-key-placeholder="usernamePlaceholder">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="email" data-key="emailLabel">Your Email Address</label>
IÂ  Â  Â  Â  Â  Â  Â  <input type="email" id="email" data-key-placeholder="emailPlaceholder">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="phone" data-key="phoneLabel">Your Phone Number</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" id="phone" data-key-placeholder="phonePlaceholder">
Â  Â  Â  Â  Â  D</div>
Â  Â  Â  Â  Â  Â  <button id="login-btn" data-key="loginBtn">Start</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="dashboard-page" class="page">
Â  Â  Â  Â  <div class="header"><h1>Welcome, <span id="display-username"></span>!</h1></div>
Â  Â  Â  Â  <div class="sos-container">
Â  Â  Â  Â  Â  Â  <button id="sos-btn">SOS</button>
Â  Â  Â  Â  Â  Â  <div id="camera-container">
Â  Â  Â  Â  Â  Â  Â  Â  <video id="camera-view" autoplay playsinline style="width:100%; height:100%; object-fit: cover;"></video>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="actions-grid">
Â  Â  Â  Â  Â  Â  <button id="manage-contacts-btn" data-key="manageContactsBtn">Manage Contacts</button>
Â  Â  Â  Â  Â  Â  <button id="view-map-btn" data-key="viewMapBtn">Crime Hotspots</button>
Â  Â  Â  Â  Â  Â  <button id="switch-camera-btn" data-key="switchCameraBtn">Switch Camera</button>
Â  Â  Â  Â  Â  Â  <button id="call-112-btn" data-key="call112Btn">Call 112</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="chat-screen">
Â  Â  Â  Â  Â  Â  <div class="chat-messages" id="chat-messages"></div>
Â  Â  Â  Â  Â  Â  <div class="chat-input-area">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="chat-call-btn">ðŸ“ž</button>
preÂ  Â  Â  Â  Â  Â  Â  <input type="text" id="chat-input" data-key-placeholder="inputPlaceholder">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="send-btn" data-key="sendBtn">âž¤</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="contacts-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <span class="close-btn">&times;</span>
Â  Â  Â  Â  Â  Â  <h3 data-key="contactsTitle">Emergency Contacts</h3>
Â  Â  Â  Â  Â  Â  <ul id="contacts-list"></ul>
Â  Â  Â  Â  Â  Â  <h4 data-key="addContactTitle">Add New Contact</h4>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="contact-name" data-key="contactNamePlaceholder">Name</label>
sÂ  Â  Â  Â  Â  Â  Â  <input type="text" id="contact-name" data-key-placeholder="contactNamePlaceholder">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="contact-email" data-key="contactEmailPlaceholder">Email</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="contact-email" data-key-placeholder="emailPlaceholder">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
lÂ  Â  Â  Â  Â  Â  Â  <label for="contact-phone" data-key="contactPhonePlaceholder">Phone</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" id="contact-phone" data-key-placeholder="contactPhonePlaceholder">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button id="add-contact-btn" data-key="addContactBtn">Add Contact</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="map-container">
Â  Â  Â  Â  <div id="map"></div>
Â  Â  Â  Â  <span class="close-btn" onclick="document.getElementById('map-container').style.display='none'">&times;</span>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // Activate the service worker for offline capabilities
Â  Â  Â  Â  if ('serviceWorker' in navigator) {
Â  Â  Â  Â  Â  Â  window.addEventListener('load', () => {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.serviceWorker.register('/service-worker.js').then(registration => {
iÂ  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ServiceWorker registration successful with scope: ', registration.scope);
Â  Â  Â  Â  Â  Â  Â  Â  }, err => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ServiceWorker registration failed: ', err);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const translations = {
Â  Â  Â  Â  Â  Â  Â  Â  en: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  languageLabel: "Language", usernameLabel: "Your Name", emailLabel: "Your Email Address", phoneLabel: "Your Phone Number",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  phonePlaceholder: "e.g., +919876543210", manageContactsBtn: "Manage Contacts", viewMapBtn: "Crime Hotspots", switchCameraBtn: "Switch Camera",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contactsTitle: "Emergency Contacts", addContactTitle: "Add New Contact", contactNamePlaceholder: "Name", contactEmailPlaceholder: "Email (Optional)", contactPhonePlaceholder: "Phone (e.g., +91...)", addContactBtn: "Add Contact",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  botRecording: "Recording video for 90 seconds. Alerts will be sent upon completion. Stay safe.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loginTitle: "Durga Kavach", loginSubtitle: "Please enter your details to begin.", usernamePlaceholder: "Enter your full name", emailPlaceholder: "Enter your email", loginBtn: "Start", welcome: "Welcome,", inputPlaceholder: "Type your message here...",
isÂ  Â  Â  Â  Â  Â  Â  Â  Â  botWelcome: "Welcome! For emergencies, press SOS or type 'help'.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  botTriggerSOS: "Understood. Initiating SOS and alerting authorities.",
EÂ  Â  Â  Â  Â  Â  Â  Â  Â  botUnknown: "Sorry, I don't understand. In an emergency, please press the SOS button.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  postSosGreeting: "Alerts sent. Help is on the way.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  postSosReassurance: "I'm here with you. Try to breathe slowly.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseReassurance: "It's okay to feel scared. Help is confirmed. You are not alone.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseLocationInfo: "Thank you. This information will help the response team.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  botEvidenceSaved: "Evidence backup saved to your device.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  call112Btn: "Call 112",
Two Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  mr: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  languageLabel: "à¤­à¤¾à¤·à¤¾", usernameLabel: "à¤¤à¥à¤®à¤šà¥‡ à¤¨à¤¾à¤µ", emailLabel: "à¤¤à¥à¤®à¤šà¤¾ à¤ˆà¤®à¥‡à¤² à¤ªà¤¤à¥à¤¤à¤¾", phoneLabel: "à¤¤à¥à¤®à¤šà¤¾ à¤«à¥‹à¤¨ à¤¨à¤‚à¤¬à¤°",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  phonePlaceholder: "à¤‰à¤¦à¤¾. +919876543210", manageContactsBtn: "à¤¸à¤‚à¤ªà¤°à¥à¤• à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¤¾", viewMapBtn: "à¤—à¥à¤¨à¥à¤¹à¥‡à¤—à¤¾à¤°à¥€ à¤¹à¥‰à¤Ÿà¤¸à¥à¤ªà¥‰à¤Ÿ", switchCameraBtn: "à¤•à¥…à¤®à¥‡à¤°à¤¾ à¤¬à¤¦à¤²à¤¾",
Note:Â  Â  Â  Â  Â  Â  Â  Â  Â  contactsTitle: "à¤†à¤ªà¤¤à¥à¤•à¤¾à¤²à¥€à¤¨ à¤¸à¤‚à¤ªà¤°à¥à¤•", addContactTitle: "à¤¨à¤µà¥€à¤¨ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤œà¥‹à¤¡à¤¾", contactNamePlaceholder: "à¤¨à¤¾à¤µ", contactEmailPlaceholder: "à¤ˆà¤®à¥‡à¤² (à¤à¤šà¥à¤›à¤¿à¤•)", contactPhonePlaceholder: "à¤«à¥‹à¤¨ (à¤‰à¤¦à¤¾. +91...)", addContactBtn: "à¤¸à¤‚à¤ªà¤°à¥à¤• à¤œà¥‹à¤¡à¤¾",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  botRecording: "à¥¯à¥¦ à¤¸à¥‡à¤•à¤‚à¤¦à¤¾à¤‚à¤¸à¤¾à¤ à¥€ à¤µà¥à¤¹à¤¿à¤¡à¤¿à¤“ à¤°à¥‡à¤•à¥‰à¤°à¥à¤¡ à¤•à¤°à¤¤ à¤†à¤¹à¥‡. à¤ªà¥‚à¤°à¥à¤£ à¤à¤¾à¤²à¥à¤¯à¤¾à¤µà¤° à¤¸à¥‚à¤šà¤¨à¤¾ à¤ªà¤¾à¤ à¤µà¤²à¥€ à¤œà¤¾à¤ˆà¤². à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤°à¤¹à¤¾.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loginTitle: "à¤¦à¥à¤°à¥à¤—à¤¾ à¤•à¤µà¤š", loginSubtitle: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¸à¥à¤°à¥‚ à¤•à¤°à¤£à¥à¤¯à¤¾à¤¸à¤¾à¤ à¥€ à¤†à¤ªà¤²à¥‡ à¤¤à¤ªà¤¶à¥€à¤² à¤ªà¥à¤°à¤µà¤¿à¤·à¥à¤Ÿ à¤•à¤°à¤¾.", usernamePlaceholder: "à¤¤à¥à¤®à¤šà¥‡ à¤ªà¥‚à¤°à¥à¤£ à¤¨à¤¾à¤µ à¤Ÿà¤¾à¤•à¤¾", emailPlaceholder: "à¤¤à¥à¤®à¤šà¤¾ à¤ˆà¤®à¥‡à¤² à¤Ÿà¤¾à¤•à¤¾", loginBtn: "à¤¸à¥à¤°à¥‚ à¤•à¤°à¤¾", welcome: "à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤†à¤¹à¥‡,", inputPlaceholder: "à¤¤à¥à¤®à¤šà¤¾ à¤¸à¤‚à¤¦à¥‡à¤¶ à¤¯à¥‡à¤¥à¥‡ à¤Ÿà¤¾à¤‡à¤ª à¤•à¤°à¤¾...",
IndentationÂ  Â  Â  Â  Â  Â  Â  Â  Â  botWelcome: "à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤†à¤¹à¥‡! à¤†à¤ªà¤¤à¥à¤•à¤¾à¤²à¥€à¤¨ à¤ªà¤°à¤¿à¤¸à¥à¤¥à¤¿à¤¤à¥€à¤¤, à¤à¤¸à¤“à¤à¤¸ à¤¬à¤Ÿà¤£ à¤¦à¤¾à¤¬à¤¾ à¤•à¤¿à¤‚à¤µà¤¾ 'à¤®à¤¦à¤¤' à¤Ÿà¤¾à¤‡à¤ª à¤•à¤°à¤¾.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  botTriggerSOS: "à¤¸à¤®à¤œà¤²à¥‡. à¤à¤¸à¤“à¤à¤¸ à¤ªà¥à¤°à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤¸à¥à¤°à¥‚ à¤•à¤°à¤¤ à¤†à¤¹à¥‡ à¤†à¤£à¤¿ à¤…à¤§à¤¿à¤•à¤¾à¤±à¥à¤¯à¤¾à¤‚à¤¨à¤¾ à¤¸à¥‚à¤šà¤¿à¤¤ à¤•à¤°à¤¤ à¤†à¤¹à¥‡.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  botUnknown: "à¤•à¥à¤·à¤®à¤¸à¥à¤µ, à¤®à¤²à¤¾ à¤¸à¤®à¤œà¤²à¥‡ à¤¨à¤¾à¤¹à¥€. à¤†à¤ªà¤¤à¥à¤•à¤¾à¤²à¥€à¤¨ à¤ªà¤°à¤¿à¤¸à¥à¤¥à¤¿à¤¤à¥€à¤¤, à¤•à¥ƒà¤ªà¤¯à¤¾ à¤à¤¸à¤“à¤à¤¸ à¤¬à¤Ÿà¤£ à¤¦à¤¾à¤¬à¤¾.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  postSosGreeting: "à¤¸à¥‚à¤šà¤¨à¤¾ à¤ªà¤¾à¤ à¤µà¤²à¥€ à¤†à¤¹à¥‡. à¤®à¤¦à¤¤ à¤®à¤¾à¤°à¥à¤—à¤¾à¤µà¤° à¤†à¤¹à¥‡.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  postSosReassurance: "à¤®à¥€ à¤¤à¥à¤®à¤šà¥à¤¯à¤¾à¤¸à¥‹à¤¬à¤¤ à¤†à¤¹à¥‡. à¤¹à¤³à¥‚ à¤¶à¥à¤µà¤¾à¤¸ à¤˜à¥‡à¤£à¥à¤¯à¤¾à¤šà¤¾ à¤ªà¥à¤°à¤¯à¤¤à¥à¤¨ à¤•à¤°à¤¾.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseReassurance: "à¤˜à¤¾à¤¬à¤°à¥‚à¤¨ à¤œà¤¾à¤£à¥‡ à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯ à¤†à¤¹à¥‡. à¤®à¤¦à¤¤ à¤¨à¤¿à¤¶à¥à¤šà¤¿à¤¤à¤ªà¤£à¥‡ à¤¯à¥‡à¤¤ à¤†à¤¹à¥‡. à¤¤à¥à¤®à¥à¤¹à¥€ à¤à¤•à¤Ÿà¥‡ à¤¨à¤¾à¤¹à¥€ à¤†à¤¹à¤¾à¤¤.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseLocationInfo: "à¤®à¤¾à¤¹à¤¿à¤¤à¥€à¤¬à¤¦à¥à¤¦à¤² à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦. à¤¯à¤¾à¤®à¥à¤³à¥‡ à¤ªà¥à¤°à¤¤à¤¿à¤¸à¤¾à¤¦ à¤ªà¤¥à¤•à¤¾à¤²à¤¾ à¤®à¤¦à¤¤ à¤¹à¥‹à¤ˆà¤².",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  botEvidenceSaved: "à¤ªà¥à¤°à¤¾à¤µà¥à¤¯à¤¾à¤šà¤¾ à¤¬à¥…à¤•à¤…à¤ª à¤¤à¥à¤®à¤šà¥à¤¯à¤¾ à¤¡à¤¿à¤µà¥à¤¹à¤¾à¤‡à¤¸à¤µà¤° à¤¸à¥‡à¤µà¥à¤¹ à¤à¤¾à¤²à¤¾ à¤†à¤¹à¥‡.",
iÂ  Â  Â  Â  Â  Â  Â  Â  Â  call112Btn: "112 à¤µà¤° à¤•à¥‰à¤² à¤•à¤°à¤¾",
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  const appState = { currentUser: null, sosActive: false, sosSent: false, mediaStream: null, language: 'en', contacts: [ { name: 'Police Control Room', email: 'durgakavach00@gmail.com', phone: '112', default: true }, { name: 'Women Helpline', phone: '1091', default: true } ], currentFacingMode: 'user' };
Â  Â  Â  Â  Â  Â  const loginPage = document.getElementById('login-page'), dashboardPage = document.getElementById('dashboard-page'), loginBtn = document.getElementById('login-btn'), sosBtn = document.getElementById('sos-btn'), displayUsername = document.getElementById('display-username'), manageContactsBtn = document.getElementById('manage-contacts-btn'), viewMapBtn = document.getElementById('view-map-btn'), contactsModal = document.getElementById('contacts-modal'), closeModalBtn = contactsModal.querySelector('.close-btn'), addContactBtn = document.getElementById('add-contact-btn'), contactsList = document.getElementById('contacts-list'), langSelector = document.getElementById('language-selector'), chatMessages = document.getElementById('chat-messages'), chatInput = document.getElementById('chat-input'), sendBtn = document.getElementById('send-btn'), cameraView = document.getElementById('camera-view'), switchCameraBtn = document.getElementById('switch-camera-btn'), cameraContainer = document.getElementById('camera-container'), call112Btn = document.getElementById('call-112-btn'), chatCallBtn = document.getElementById('chat-call-btn');
Â  Â  Â  Â  Â  Â  let map;

Â  Â  Â  Â  Â  Â  function setLanguage(lang) {
Â  Â  Â  Â  Â  Â  Â  Â  appState.language = lang;
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('[data-key]').forEach(elem => { const key = elem.getAttribute('data-key'); if (translations[lang] && translations[lang][key]) { elem.innerText = translations[lang][key]; } });
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('[data-key-placeholder]').forEach(elem => { const key = elem.getAttribute('data-key-placeholder'); if (translations[lang] && translations[lang][key]) { elem.placeholder = translations[lang][key]; } });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  async function requestPermissions(facingMode = 'user') {
Â  Â  Â  Â  Â  Â  Â  Â  if (appState.mediaStream) { appState.mediaStream.getTracks().forEach(track => track.stop()); }
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const constraints = { video: { facingMode: facingMode }, audio: true };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appState.mediaStream = await navigator.mediaDevices.getUserMedia(constraints);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cameraView.srcObject = appState.mediaStream;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appState.currentFacingMode = facingMode;
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) { console.error('Permission denied:', error); alert('Camera and microphone access is required. Please allow permissions and reload.'); }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function switchCamera() {
Â  Â  Â  Â  Â  Â  Â  Â  const newFacingMode = appState.currentFacingMode === 'user' ? 'environment' : 'user';
Â  Â  Â  Â  Â  Â  Â  Â  requestPermissions(newFacingMode);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function displayMessage(text, sender) {
Â  Â  Â  Â  Â  Â  Â  Â  const messageElem = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  messageElem.classList.add('message', `${sender}-message`);
Â  Â  Â  Â  Â  Â  Â  Â  messageElem.innerHTML = text.replace(/\n/g, '<br>');
Â  Â  Â  Â  Â  Â  Â  Â  chatMessages.appendChild(messageElem);
Â  Â  Â  Â  Â  Â  Â  Â  chatMessages.scrollTop = chatMessages.scrollHeight;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  async function handleUserMessage(message) {
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(message, 'user');
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/api/detect-intent', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ text: message, lang: appState.language }) });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('Server error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  _Â  Â  Â  let botResponse = "";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switch (data.intent) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'ReportThreat':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  botResponse = translations[appState.language].botTriggerSOS;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!appState.sosActive) triggerSOS();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'RequestReassurance': botResponse = translations[appState.language].responseReassurance; break;
sÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'ProvideLocationInfo': botResponse = translations[appState.language].responseLocationInfo; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  default: botResponse = data.responseText || translations[appState.language].botUnknown; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(botResponse, 'bot');
sÂ  Â  Â  Â  Â  Â  } catch (error) { console.error("Error detecting intent:", error); displayMessage("Sorry, I'm having trouble understanding right now.", 'bot'); }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function triggerSOS() {
Â  Â  Â  Â  Â  Â  Â  Â  if(appState.sosActive) return;
Â  Â  Â  Â  Â  Â  Â  Â  appState.sosActive = true;
Â  Â  Â  Â  Â  Â  Â  Â  sosBtn.classList.add('recording');
Â  Â  Â  Â  Â  Â  Â  Â  sosBtn.textContent = '...';
Â  Â  Â  Â  Â  Â  Â  Â  cameraContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(translations[appState.language].botRecording, 'bot');
Â  Â  Â  Â  Â  Â  Â  Â  if (!appState.mediaStream) { alert('Cannot start SOS. Media permissions not granted.'); resetSOSButton(); return; }
Â  Â  Â  Â  Â  Â  Â  Â  const mediaRecorder = new MediaRecorder(appState.mediaStream, { mimeType: 'video/webm' });
Â  Â  Â  Â  Â  Â  Â  Â  let videoChunks = [];
Â  Â  Â  Â  Â  Â  Â  Â  mediaRecorder.ondataavailable = event => videoChunks.push(event.data);
sÂ  Â  Â  Â  Â  Â  Â  mediaRecorder.start();
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { if (mediaRecorder.state === 'recording') { mediaRecorder.stop(); } }, 90000); // 90 seconds
Â  Â  Â  Â  Â  Â  Â  Â  mediaRecorder.onstop = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const videoBlob = new Blob(videoChunks, { type: 'video/webm' });
sÂ  Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(videoBlob);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reader.onloadend = () => { sendAlertPackage(reader.result); };
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function sendAlertPackage(videoData) {
EÂ  Â  Â  Â  Â  Â  Â  // âœ… PRECISION UPDATE: Using options for high accuracy
Â  Â  Â  Â  Â  Â  Â  Â  const geolocationOptions = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enableHighAccuracy: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeout: 10000, // Wait up to 10 seconds for a good fix
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maximumAge: 0 // Force a fresh reading, not a cached one
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  navigator.geolocation.getCurrentPosition(position => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const alertPackage = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  username: appState.currentUser.username,
email: appState.currentUser.email,
phone: appState.currentUser.phone,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // âœ… PRECISION UPDATE: Sending lat, lng, AND accuracy
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  location: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lat: position.coords.latitude,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lng: position.coords.longitude,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accuracy: position.coords.accuracyÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  videoData: videoData,sÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  emergencyContacts: appState.contactsÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetch('/api/send-alert', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(alertPackage) })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .then(res => res.json())
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sosBtn.textContent = 'SENT';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  s Â  Â  Â  sosBtn.classList.remove('recording');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sosBtn.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  s Â  Â  Â  appState.sosSent = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backupEvidence(videoData, new Date().toISOString());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => displayMessage(translations[appState.language].postSosGreeting, 'bot'), 1000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => displayMessage(translations[appState.language].postSosReassurance, 'bot'), 2500);
EÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { resetSOSButton(); alert('Failed to send alerts.'); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).catch(err => { console.error('Fetch Error:', err); resetSOSButton(); alert('Network error.'); });
SÂ  Â  Â  Â  Â  Â  Â  }, () => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetSOSButton();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Could not get a precise location. Please ensure GPS is enabled and try again.');sÂ 
Â  Â  Â  Â  Â  Â  Â  Â  }, geolocationOptions); // Using the high-accuracy options
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function resetSOSButton() { appState.sosActive = false; appState.sosSent = false; sosBtn.classList.remove('recording', 'active'); sosBtn.textContent = 'SOS'; cameraContainer.style.display = 'none'; }
Â  Â  Â  Â  Â  Â  function loadContacts() { const savedContacts = localStorage.getItem('userContacts'); if (savedContacts) { appState.contacts.push(...JSON.parse(savedContacts)); } renderContacts(); }
Â  Â  Â  Â  Â  Â  function saveContacts() { const userContacts = appState.contacts.filter(c => !c.default); localStorage.setItem('userContacts', JSON.stringify(userContacts)); }
is Â  Â  Â  Â  Â  function renderContacts() { contactsList.innerHTML = ''; appState.contacts.forEach((contact, index) => { const li = document.createElement('li'); li.innerHTML = `<span>${contact.name}</span> <small>${contact.phone || contact.email}</small>`; if (!contact.default) { const deleteBtn = document.createElement('button'); deleteBtn.textContent = 'X'; deleteBtn.className = 'delete-btn'; deleteBtn.onclick = () => { appState.contacts.splice(index, 1); saveContacts(); renderContacts(); }; li.appendChild(deleteBtn); } contactsList.appendChild(li); }); }
Â  Â  Â  Â  Â  Â  function backupEvidence(videoData, timestamp) { const download = (dataUrl, filename) => { const link = document.createElement('a'); link.href = dataUrl; link.download = filename; link.click(); }; download(videoData, `evidence-video-${timestamp.replace(/:/g, '-')}.webm`); displayMessage(translations[appState.language].botEvidenceSaved, 'bot'); }
Â  Â  Â  Â  Â  Â  function showMapWithHotspots() { const mapContainer = document.getElementById('map-container'); mapContainer.style.display = 'flex'; if (!map) { map = L.map('map').setView([16.8524, 74.5815], 13); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map); } fetch('crime_data.json').then(res => res.json()).then(data => { data.hotspots.forEach(hotspot => { const details = appState.language === 'mr' ? hotspot.details_mr : hotspot.details_en; L.circle([hotspot.lat, hotspot.lng], { color: 'red', radius: 300 }).addTo(map).bindPopup(details); }); }); }

Â  Â  Â  Â  Â  Â  loginBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  const username = document.getElementById('username').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  const email = document.getElementById('email').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  const phone = document.getElementById('phone').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if (username && email && phone) {
Â  g Â  Â  Â  Â  Â  Â  Â  Â  appState.currentUser = { username, email, phone };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayUsername.textContent = username;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loginPage.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dashboardPage.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLanguage(appState.language);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  requestPermissions();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(translations[appState.language].botWelcome, 'bot');
Â  Â  Â  Â  Â  Â  Â  Â  } else { alert('Please provide a name, email, and phone number.'); }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  langSelector.addEventListener('change', (e) => setLanguage(e.target.value));
iÂ  Â  Â  Â  Â  sendBtn.addEventListener('click', () => { const message = chatInput.value.trim(); if (message) { handleUserMessage(message); chatInput.value = ''; } });
Â  Â  Â  Â  Â  Â  chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { sendBtn.click(); } });
Â  Â  Â  Â  Â  Â  sosBtn.addEventListener('click', triggerSOS);
Â  Â  Â  Â  Â  Â  viewMapBtn.addEventListener('click', showMapWithHotspots);
FurtherÂ  Â  Â  Â  Â  manageContactsBtn.addEventListener('click', () => { contactsModal.style.display = 'flex'; });
Â  Â  Â  Â  Â  Â  closeModalBtn.addEventListener('click', () => { contactsModal.style.display = 'none'; });
Â  Â  Â  Â  Â  Â  addContactBtn.addEventListener('click', () => { const name = document.getElementById('contact-name').value.trim(); const email = document.getElementById('contact-email').value.trim(); const phone = document.getElementById('contact-phone').value.trim(); if (name && (email || phone)) { appState.contacts.push({ name, email, phone, default: false }); saveContacts(); renderContacts(); document.getElementById('contact-name').value = ''; document.getElementById('contact-email').value = ''; document.getElementById('contact-phone').value = ''; } else { alert('Please provide a name and at least an email or phone number.'); }});
Â  Â  Â  Â  Â  Â  call112Btn.addEventListener('click', () => { window.location.href = 'tel:112'; });
Â  Â  Â  Â  Â  Â  chatCallBtn.addEventListener('click', () => { window.location.href = 'tel:112'; });

Â  Â  Â  Â  Â  Â  loadContacts();
Â  Â  Â  Â  Â  Â  setLanguage(appState.language);
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
